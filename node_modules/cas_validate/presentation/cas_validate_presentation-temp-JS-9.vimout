\SYNBOL{}\SYN[Identifier]{function} callback\SYN[javaScriptParens]{(}err, resp, body\SYN[javaScriptParens]{)} \SYN[Identifier]{\{}\SYNEOL{}
\SYNBOL{}    \SYN[Statement]{if} \SYN[javaScriptParens]{(}!err && resp.statusCode === \SYN[javaScriptValue]{200}\SYN[javaScriptParens]{)} \SYN[Identifier]{\{}\SYNEOL{}
\SYNBOL{}        \SYN[Statement]{if}\SYN[javaScriptParens]{(}\SYN[Constant]{/cas:authenticationSuccess/}.exec\SYN[javaScriptParens]{(}body\SYN[javaScriptParens]{))}\SYN[Identifier]{\{}\SYNEOL{}
\SYNBOL{}            \SYN[Statement]{if}\SYN[javaScriptParens]{(}\SYN[Constant]{/<cas:user>(\\w+)<\\/cas:user>/}.exec\SYN[javaScriptParens]{(}body\SYN[javaScriptParens]{))}\SYN[Identifier]{\{}\SYNEOL{}
\SYNBOL{}                req.session.name = \SYN[Type]{RegExp}.$\SYN[javaScriptValue]{1};\SYNEOL{}
\SYNBOL{}            \SYN[Identifier]{\}}\SYNEOL{}
\SYNBOL{}            req.session.st = ticket;\SYNEOL{}
\SYNBOL{}            redclient.set\SYN[javaScriptParens]{(}ticket,req.sessionID\SYN[javaScriptParens]{)};\SYNEOL{}
\SYNBOL{}            \SYN[Statement]{return} next\SYN[javaScriptParens]{()};\SYNEOL{}
\SYNBOL{}        \SYN[Identifier]{\}}\SYN[Statement]{else}\SYN[Identifier]{\{}  next\SYN[javaScriptParens]{(}\SYN[Statement]{new} Error\SYN[javaScriptParens]{(}\SYN[Constant]{'authentication failed'}\SYN[javaScriptParens]{))}; \SYN[Identifier]{\}}\SYNEOL{}
\SYNBOL{}    \SYN[Identifier]{\}}\SYN[Statement]{else}\SYN[Identifier]{\{} next\SYN[javaScriptParens]{(}\SYN[Statement]{new} Error\SYN[javaScriptParens]{(}\SYN[Constant]{'authentication failed'}\SYN[javaScriptParens]{))}; \SYN[Identifier]{\}}\SYNEOL{}
\SYNBOL{}\SYN[Identifier]{\}}\SYNEOL{}
